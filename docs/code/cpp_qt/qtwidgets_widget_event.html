<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-code/cpp_qt/qtwidgets_widget_event" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">widget控件的常用事件 | li-tann</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://li-tann.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://li-tann.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://li-tann.github.io/docs/code/cpp_qt/qtwidgets_widget_event"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="widget控件的常用事件 | li-tann"><meta data-rh="true" name="description" content="Qt Widget控件的拖拽、绘制等事件"><meta data-rh="true" property="og:description" content="Qt Widget控件的拖拽、绘制等事件"><link data-rh="true" rel="icon" href="/img/SAR-LOGO2.png"><link data-rh="true" rel="canonical" href="https://li-tann.github.io/docs/code/cpp_qt/qtwidgets_widget_event"><link data-rh="true" rel="alternate" href="https://li-tann.github.io/docs/code/cpp_qt/qtwidgets_widget_event" hreflang="en"><link data-rh="true" rel="alternate" href="https://li-tann.github.io/docs/code/cpp_qt/qtwidgets_widget_event" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="li-tann RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="li-tann Atom Feed">




<link rel="stylesheet" href="/katex/katex.min.css"><link rel="stylesheet" href="/assets/css/styles.81049be4.css">
<script src="/assets/js/runtime~main.148f31ff.js" defer="defer"></script>
<script src="/assets/js/main.ec25c690.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/SAR-LOGO2.png" alt="Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/SAR-LOGO2.png" alt="Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">li-tann&#x27;s Notebook</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro">💬Document</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/code/intro">🧙Code</a><a class="navbar__item navbar__link" href="/blog">🏷️Blog</a><a href="https://github.com/li-tann/li-tann.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">🚀GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/SAR-LOGO2.png" alt="Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/SAR-LOGO2.png" alt="Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"><b>li-tann&#x27;s Notebook</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/code/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/cpp">Cpp</a><button aria-label="Expand sidebar category &#x27;Cpp&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/cpp-qt">Cpp Qt</a><button aria-label="Collapse sidebar category &#x27;Cpp Qt&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp_qt/qclass_QCryptographicHash">MD5码获取</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp_qt/qclass_QFileSystemWatcher">文件夹监控功能</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp_qt/qclass_QNetWorkAccessManager">QNetWork下载文件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp_qt/qclass_QString">QString功能</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp_qt/qclass_QThread">QThread 多线程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp_qt/qclass_database">Qt Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp_qt/qgraphics">QGraphics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp_qt/qmake_syntax">qmake语法（pro文件写法）</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp_qt/qtwidgets_combobox">QComboBox</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp_qt/qtwidgets_stackwidget_buttongroup">stackWidget &amp; buttonGroup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp_qt/qtwidgets_tablewidget">TableWidget</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/code/cpp_qt/qtwidgets_widget_event">widget控件的常用事件</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/cmake">CMake</a><button aria-label="Expand sidebar category &#x27;CMake&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/python">Python</a><button aria-label="Expand sidebar category &#x27;Python&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/cuda">CUDA</a><button aria-label="Expand sidebar category &#x27;CUDA&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/shell">Shell</a><button aria-label="Expand sidebar category &#x27;Shell&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/cpp-qt"><span itemprop="name">Cpp Qt</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">widget控件的常用事件</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>widget控件的常用事件</h1>
<p>Qt Widget控件的拖拽、绘制等事件</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="paintevent绘图事件">paintEvent绘图事件<a href="#paintevent绘图事件" class="hash-link" aria-label="Direct link to paintEvent绘图事件" title="Direct link to paintEvent绘图事件">​</a></h2>
<p>paintEvent(QPaintEvent *event) 主要用于图形的绘制，当设置布局（layout）后，改变窗口尺寸会触发update/repaint？事件，重新对QWidget进行绘制</p>
<p>使用方法：</p>
<p>以<strong>渐变色条</strong>为例，</p>
<p>创建一个“plus”版的widget控件，重载paintEvent事件，不关注<code>mousePressEvent</code></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//// .h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">widget_plus1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:#00009f">public</span><span class="token base-clause"> </span><span class="token base-clause class-name">QWidget</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Q_OBJECT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">explicit</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">widget_plus1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">QWidget </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">parent </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nullptr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">~</span><span class="token function" style="color:#d73a49">widget_plus1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> widget_plus1_num</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">protected</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">paintEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">QPaintEvent</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mousePressEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">QMouseEvent</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">signals</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mousePressed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>函数的定义：</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/// .cpp </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">widget_plus1</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">widget_plus1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">QWidget </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">parent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">QWidget</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">parent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">widget_plus1</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token operator" style="color:#393A34">~</span><span class="token function" style="color:#d73a49">widget_plus1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> widget_plus1</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">paintEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">QPaintEvent </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    QPainter </span><span class="token function" style="color:#d73a49">painter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    painter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setRenderHint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">QPainter</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Antialiasing</span><span class="token punctuation" style="color:#393A34">,</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// 规定线性梯度的样式, 此处线性变形规定起点为(0,0) 终点为(0,height) , 目的是线性变形与横坐标无关, 即水平方向的颜色显示相同</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    QLinearGradient </span><span class="token function" style="color:#d73a49">Linear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// 设置起止点的颜色</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Linear</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setColorAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token function" style="color:#d73a49">QColor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Linear</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setColorAt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token function" style="color:#d73a49">QColor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// 将笔刷设置为刚才设置好的线性梯度变化样式 Linear</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    painter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setBrush</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Linear</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    painter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">setPen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Qt</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">transparent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// 规定painter的绘画区域, 此处自由设置, 示例中希望绘制区域与窗口尺寸相同</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    painter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">drawRect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">Q_UNUSED</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> widget_plus1</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">mousePressEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">QMouseEvent </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    QPoint mouse </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> event</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">pos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    widget_plus1_num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mouse</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">y</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">255</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    emit </span><span class="token function" style="color:#d73a49">mousePressed</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>结果展示：</p>
<p><img loading="lazy" src="/assets/images/press_event__linear_gradien-cd67fe2d4727d6f4656db2e6eebe9369.png" width="504" height="682" class="img_ev3q"></p>
<p>paintEvent 绘图事件,  在窗体显示影像时使用率非常高</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dragenterevent-dropevent-拖拽事件">dragEnterEvent dropEvent 拖拽事件<a href="#dragenterevent-dropevent-拖拽事件" class="hash-link" aria-label="Direct link to dragEnterEvent dropEvent 拖拽事件" title="Direct link to dragEnterEvent dropEvent 拖拽事件">​</a></h2>
<p>实现拖动数据进度该组件并进行处理的情况</p>
<p>dropEnterEvent的官方说明:</p>
<p>This event handler is called when a drag is in progress and the mouse enters this widget. The event is passed in the event parameter.
If the event is ignored, the widget won&#x27;t receive any drag move events.</p>
<p>当拖动过程中鼠标进入此小部件时，将调用此事件处理程序。事件在事件参数中传递。</p>
<p>如果忽略该事件，小部件将不会收到任何拖动事件。</p>
<p>dropEvent的官方说明:</p>
<p>This event handler is called when the drag is dropped on this widget. The event is passed in the event parameter.</p>
<p>当拖放到此小部件上时，将调用此事件处理程序。事件在事件参数中传递。</p>
<p><a href="https://blog.csdn.net/xiaolong1126626497/article/details/114024762" target="_blank" rel="noopener noreferrer">该功能很重要但未来得及测试和学习，故先放链接，待后续学习和使用后再详细说明心得</a></p>
<p>也可以再QtCreator的帮助中搜索“Drag and Drop”查看文档学习。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="paintevent_version2">paintEvent_version2<a href="#paintevent_version2" class="hash-link" aria-label="Direct link to paintEvent_version2" title="Direct link to paintEvent_version2">​</a></h2>
<p>（其中以说明思路为主配有部分代码段，但可能不完整，不保证代码复制粘贴后可直接使用。思路清晰后写代码并不困难）</p>
<p>（代码中使用qimage直接读取其可识别的文件格式，如果读遥感影像，则需要自己完善前面相应的步骤）</p>
<p>使用paintEvent打印图像到widget中，并且通过指针显示影像坐标（像平面坐标）</p>
<p>下面代码如果没有特殊标注，全都是<code>void paintEvent(QPaintEvent* event){...}</code>槽函数中的代码。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1影像的初始化显示">1.影像的初始化显示<a href="#1影像的初始化显示" class="hash-link" aria-label="Direct link to 1.影像的初始化显示" title="Direct link to 1.影像的初始化显示">​</a></h3>
<p>基本思想是将image填充到widget的窗口中，代码为：</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">QPainter painter</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QImage image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QImage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QRectF target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QRectF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QRectF source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QRectF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">painter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">drawImage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>将在<code>source</code>范围的<code>image</code>图像打印到widget控件的<code>target</code>范围内。</p>
<p>source的确定：</p>
<p>由于影像与窗口的长宽比例不同，直接将整景影像打印到窗口中会出现横向或纵向的拉伸效果。<strong>错误</strong>代码如下：</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">QPainter painter</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QImage image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QImage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QRectF target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QRectF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QRectF source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QRectF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">painter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">drawImage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>需要确定影像与窗口各自的高宽比（或宽高比均可），根据情况将影像缩放至适当比例，并选择正确的成像范围<code>source</code>。</p>
<p>以高宽比为例，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mfrac><mi>h</mi><mi>w</mi></mfrac></msub><mo>=</mo><mi>h</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi mathvariant="normal">/</mi><mi>w</mi><mi>i</mi><mi>d</mi><mi>t</mi><mi>h</mi></mrow><annotation encoding="application/x-tex">r_{\frac{h}{w}} = height / width</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9426em;vertical-align:-0.512em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em"><span style="top:-2.7288em;margin-left:-0.0278em;margin-right:0.05em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.88em"><span style="top:-2.656em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em">w</span></span></span></span><span style="top:-3.2255em"><span class="pstrut" style="height:3em"></span><span class="frac-line mtight" style="border-bottom-width:0.049em"></span></span><span style="top:-3.384em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.512em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.02691em">w</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span></span></span></span></p>
<p>若影像高宽比大于窗口高宽比，说明影像比例纵向更长；需要以影像的高为基准，计算影像需要显示在窗口的宽度，如下图所示：
<img loading="lazy" alt="影像高宽比大于窗口高宽比" src="data:image/png;base64,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9vLycrw78l0EgBcQpCBDkKIKQQpyBKlaTs1H30UAeAFBCjK8qbk3Na9CkIIcQaoWQQoAXpEgBRlLD1LDb+CH38hz/gQpyBGkahGkAOAVCVKQIUgJUlUIUpAjSNUiSAHAKxKkIEOQEqSqEKQgR5CqRZACgFckSEGGICVIVSFIQY4gVYsgBQCvSJCCDEFKkKpCkIIcQaqWzWazX61W492R7yIAvIAgBRmClCBVhSAFOYLUPPguAsALCFKQsfQgNcyZ4cky50+QghxBah58FwHgBQQpyFh6kKIOQQpyBKl58F0EgBcQpCBDkKIKQQpyBKl58F0EgBcQpCBDkKIKQQpyBKladrvdfr1ej3dHvosA8AJDjHr37t3nMOVyub7NNfytPIIUFQhSkCNI1XJqPvouAsAL/Oc//2kenl0u1+tfw29kl+rq6mq/3W7HO86ZIAU5glQtghQAABQz/Amx3/72t4c/kfn8+umnn8ZXPRh+w9963ePl9f3XDw8anvr3v//dfN3j9fz1f/nLX/a//vWv9999913z+sMf/vDFz//d737XfN3j5fWv+/rh809fP/z81useL68/79f/6le/+uLzw7+vTw3//j/9/PNrmAdPef2X12u/fthjFxcX42ePBCkAADhTd3d3hz8h9fwa3o/judvb2+Zrh8vr+68frudO/X//eD03vP5vf/vb4U+1ta7nP//HH39svu7x8vrXff3w+ec/p/W6x8vrz/v1//znPz//Oodr+PfvuWEOPH3N02uYB895/fH6Fq//+Wv2+/8Dob3EdLGW0ZoAAAAASUVORK5CYII=" width="1188" height="331" class="img_ev3q"></p>
<p>若影像高宽比小于窗口高宽比，说明影像比例横向更长；需要以影像的宽为基准，计算影像需要显示在窗口的高度，如下图所示：
<img loading="lazy" alt="影像高宽比小于窗口高宽比" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABFkAAAEmCAYAAAC50U+NAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAABRoSURBVHhe7d0hTCTXH8DxlSfP1lWQ/CtPNQ0KWUUQlzSpIiEhJ+sqT1YgisHUICvrOImsRCIQlSdXIue/DwaWgTe83/TKO97O55O8Zud2d24v4d5v7ttlWXQAAAAAfLEnkWVvb69bLBaWZVnWzNe3337bLZfLfjoAAAAlTyJLuqj+559/+iMA5so8AACAaUQWALLMAwAAmEZkASDLPAAAgGlEFgCyzAMAAJhGZAEgyzwAAIBpRBYAsswDAACYRmQBIMs8AACAaUQWALLMAwAAmEZkASDLPAAAgGlEFgCyzAMAAJhGZAEgyzwAAIBpRBYAsswDAACYRmQBIMs8AACAaUQWALLMAwAAmEZkASDLPAAAgGlEFgCyzAMAAJhGZAEgyzwAAIBpRBYAsswDAACYRmQBIMs8AACAaUQWALLMAwAAmEZkASDLPAAAgGlEFgCyzAMAAJhGZAEgyzwAAIBpRBYAsswDAACYRmQBIMs8ACDir7/+6j5+/Piv13K57M+Ud35+nn1edDn/8+ulz1+6lri4uMg+L7qc//n1tc+f7s89L7rS63vO1z7/6elp/8g1kQWALPMAgJL0D5T0j4zcPz4i67fffuuur6/7s+V9yT8Cnf/59dLnT6sUcb70H8nO//z62udP9+eeF13p9T3na59/sXiSVEQWAPLMAwBK9vf3s/8nF2AORBYAwswDAEpEFmDORBYAwswDAEpEFmDORBYAwswDAEpEFmDORBYAwswDAEpEFmDORBYAwswDAEpEFmDORBYAwswDAEpEFmDOdnZ2+ltrIgsAWeYBACUiC8CQyAJAlnkAQInIAjAksgCQZR4AUCKyAAyJLABkmQcAlIgsAEMiCwBZ5gEAJSILwJDIAkCWeQBAicgCMCSyAJBlHgBQIrIADIksAGSZBwCUiCwAQyILAFnmAQAlaU4sl8v+CGBe9vb2+ltrIgsAWeYBAACMWyyeJBWRBYA88wAAAMaJLACEmQcAADBOZAEgzDwAAIBxIgsAYeYBAACME1kACDMPAABgnMgCQJh5AAAA40QWAMLMAwBKLi4uuuVy2R8BzIvIAkCYeQBAyf7+fnd6etofAcyLyAJAmHkAQInIAsyZyAJAmHkAQInIAsyZyAJAmHkAQInIAsyZyAJAmHkAQInIAsyZyAJAmHkAQInIAsyZyAJAmHkAQInIAszZu3fv+ltrIgsAWeYBACUiC8CQyAJAlnkAQInIAjAksgCQZR4AUCKyAAyJLABkmQcAlIgsAEMiCwBZ5gEAJSILwJDIAkCWeQBAicgCMCSyAJBlHgBQIrIADIksAGSZBwCUiCwAQyILAFnmAQAlFxcX3XK57I8A5mVvb6+/tSayAJBlHgAAwLjF4klSEVkAyDMPAABgnMgCQJh5AAAA40QWAMLMAwAAGCeyABBmHgAAwDiRBYAw8wAAAMaJLACEmQcAADBOZAEgzDwAoOTi4qJbLpf9EcC8iCwAhJkHAJTs7+93p6en/RHAvIgsAISZBwCUiCzAnIksAISZBwCUiCzAnIksAISZBwCUiCzAnIksAISZBwCUiCzAnIksAISZBwCUiCzAnIksAISZBwCUiCzAnL17966/tSayAJBlHgBQIrIADIksAGSZBwCUiCwAQyILAFnmAQAlIgvAkMgCQJZ5AECJyAIwJLIAkGUeAFAisgAMiSwAZH3NeZA+qT39SDzLsqw5rt9//73fDV+/77//PvtnsCzLmsPy04UACPua8yANLYA5Su8KSe8OacXW1lZ3cHDQHwHMS+6aVWQBIEtkAahPZAFoh8gCQJjIAlBfa5Fld3e3Ozk56Y8A5kVkASBMZAGor7XI4oNvgTkTWQAIE1kA6hNZANohsgAQJrIA1CeyALRDZAEgTGQBqE9kAWiHyAJAmMgCUJ/IAtAOkQWAMJEFoD6RBaAdIgsAYSILQH0iC0A7RBYAwkQWgPpaiyy7u7vdyclJfwQwLyILAGEiC0B9rUWWra2t7uDgoD8CmBeRBYAwkQWgPpEFoB0iCwBhIgtAfSILQDtEFgDCRBaA+kQWgHaILACEiSwA9YksAO0QWQAIE1kA6hNZANohsgAQJrIA1CeyALRDZAEgTGQBqE9kAWiHyAJAmMgCUJ/IAtAOkQWAMJEFoD6RBaAdIgsAYSILQH0iC0A7RBYAwkQWgPpEFoB2iCwAhIksAPWJLADtEFkACBNZAOoTWQDaIbIAECayANQnsgC0Q2QBIExkAaivtciyu7vbHR0d9UcA8yKyABAmsgDU11pkSa81vWaAORJZAAgTWQDqE1kA2iGyABAmsgDUJ7IAtENkASBMZAGoT2QBaIfIAkCYyAJQn8gC0A6RBYAwkQWgPpEFoB0iCwBhIgtAfSILQDtEFgDCRBaA+lqLLO/fv+9OTk76I4B5EVkACBNZAOprLbJsbW11BwcH/RHAvIgsAISJLAD1iSwA7RBZAAgTWQDqE1kA2iGyABAmsgDUJ7IAtENkASBMZAGoT2QBaIfIAkCYyAJQn8gC0A6RBYAwkQWgPpEFoB0iCwBhIgtAfSILQDtEFgDCRBaA+kQWgHaILACEiSwA9YksAO0QWQAIE1kA6hNZANohsgAQJrIA1CeyALRDZAEgTGQBqE9kAWiHyAJAmMgCUJ/IAtAOkQWAMJEFoD6RBaAdIguMuurOzs6648Pt7vis/yWYOZEFoL7WIsvu7m53dHTUHwHMi8jCjFx1x9uL1Rf9YRdqJle3gSX9JTkUWeCGyEIbJu738Mq1FlnSa02vGcrs12wekYVZuTo77g6Pr/qjiNuNv05kWf1eh8er/8LrJbLQiun7PbxeIgubzH7NphFZ4Fk1I8tZd7gtsvC6iSwA9YksAO0QWZiZq+5qUsWoFVmuurPDRbcQWXjlRBba8cx+v7rDXktLRBY2m/2azSKy0KCz7nD1hZu+eG+ixNnh7e3VSjHkJlbcHN99b+fd93reru3n3o744HNYFovt7vB4dZyLLKvHHT485+HxyOe3pHhyd77V41av9+zRb79+vY+W4MIrJLLwupX3+9s9N32g+XG/j69ury7i7/fqR3tvmjHbD8652F7Nltzm/B/OBXhMZGHz2K/ZXOnr5TGRhQak0JI22tujq+PVBni/K6427ZHPNkmPG48st/Fm+/isf+5qY03nzWy4t+Hl7jy3x9urB12d3T036X/9/nyrX7kJQiMf7JXuE1Z45UQWWjG+3/d7fdqzV0c382N1IX770MxsSXv2g9PcPv7xXv1CcwF6IgubzH7NphFZaFaq26v98O5gvYlejX941vgmfnvf+EbcHya5GBL9tZX0urOvYeTx8JqILLRifL/PXJivh8mT++4u7u+tZsz244vsl5oL0BNZ2GT2azaNyEKzHm60928nXO15V8eHwyjywPgmPrZp/vvIMrYJDwfEAyObObwmIgutGN/v4xfta1fdWXq7+uHdW9H/3UX75LkAvdYiy/v377uTk5P+CJ5nv2bTiCy0K9Xpmw1xtcluH64209vN8Dh9/2X/kMfGN/G7twQ+vi8TWe5/7e6xq+PMRnwbfkbW4809EVlogMhCK/6bi/Y0X9K+vb2aMcerC/f0dvLM/xl9qbkAvdYiy9bWVndwcNAfwfPs12ya9HXymMhCI/rN9fjw9u2BaePdXm3Sz9Tl8U38dsN9et/dRtwf9tK7ZbZXv9fdZvvk7YkrYwV8lMhCA0QWWvHlF+23+3+6b3CW3NvPV15kLkBPZGGT2a/ZNLlrVpGFZtxV5pv99mYjfX5DHN/Eb+9bb9x30gb+KLKk3yd9sG5h382fLxn5MXVPIstZd/bw07vgFRBZaMUXX7TfzJT14+7lLtpfai5AT2Rhk9mv2TQiC0272QDvN8/hRpwzvokn6fmP3z54+/2cqXCve0dfy1ePvVnp3TPpk85XDxie+fZxgzp+8yOi7z4V/ZG7QdDflyr7c38W+BpEFlrxxRft/Ux4uIdf3f+Y/zR3Vrfvz/9CcwF6IgubzH7Npslds4ostOOmRt9ttqvNcLXxPW3OjzbT+0018605q83z/ufmp892uUrPXW2+aUO9qx9nh4OfXnS1ekz6kW/p+zmfFu/0mtIGvz7ncxvz+mfxb4/+hCT4mkQWXrfyfr/+Pvu0x6e4fXucLvAH96UHr+6/nwnpMTcX23e/x4Oo/4JzARKRhc1jv2Zzpa+Xx0QWGJU26wcb9UNp8/eZKmw4kQUeMxd4eSIL/Bfs19QhssBEN+V8tQnfvbHlRnrHy+rXx78VCTaDyAJPmQu8NJEF/hv2a2oQWWCyq+4sfSr56i9P+gt0s7Z9ew/zILJAjrnAyxJZ4L9iv+bl5a5ZRRYAskQWgPpEFoB2iCwAhIksAPWJLADtEFkACBNZAOoTWQDaIbIAECayANQnsgC0Q2QBIExkAahPZAFoh8gCQJjIAlCfyALQDpEFgDCRBaA+kQWgHSILAGEiC0B9rUWW3d3d7ujoqD8CmBeRBYAwkQWgvtYiS3qt6TUDzJHIAkCYyAJQn8gC0A6RBYAwkQWgPpEFoB0iCwBhIgtAfSILQDtEFgDCRBaA+kQWgHaILACEiSwA9YksAO0QWQAIE1kA6hNZANohsgAQJrIA1NdaZHn//n13cnLSHwHMi8gCQJjIAlBfa5Fla2urOzg46I8A5kVkASBMZAGoT2QBaIfIAkCYyAJQn8gC0A6RBYAwkQWgPpEFoB0iCwBhIgtAfSILQDtEFgDCRBaA+kQWgHaILACEiSwA9YksAO0QWQAIE1kA6hNZANohsgAQJrIA1CeyALRDZAEgTGQBqE9kAWiHyAJAmMgCUJ/IAtAOkQWAMJEFoD6RBaAdIgsAYSILQH0iC0A7RBYAwkQWgPpEFoB2iCwAhIksAPWJLADtEFkACBNZAOprLbL8+OOP3dHRUX8EMC8iCwBhIgtAfa1FlvRa02sGmCORBYAwkQWgPpEFoB0iCwBhIgtAfSILQDtEFgDCRBaA+kQWgHaILACEiSwA9YksAO0QWQAIE1kA6hNZANohsgAQJrIA1CeyALRDZAEgTGQBqK+1yPLTTz91f/zxR38EMC8iCwBhIgtAfa1Flq2tre7g4KA/ApgXkQWAMJEFoD6RBaAdIgsAYSILQH0iC0A7RBYAwkQWgPpEFoB2iCwAhIksAPWJLADtEFkACBNZAOoTWQDaIbIAECayANQnsgC0Q2QBIExkAahPZAFoh8gCQJjIAlCfyALQDpEFgLCvOQ/evHnT7ezsWJZlzW5999133YcPH/rd8PX73//+133zzTfZP4tlWdamr3TN+pjIAkDW15wHl5eX3fn5uWVZ1izXcrnsd8PX7+eff+5+/fXX7J/Dsixr01e6Zn1MZAEgyzwAoCR9a1P6FicAboksAGSZBwCUiCwAQyILAFnmAQAlIgvAkMgCQJZ5AECJyAIwJLIAkGUeAFCSPvjRrADm6pdffulvrYksAGSZBwAAMG6xeJJURBYA8swDAAAYJ7IAEGYeAADAOJEFgDDzAAAAxoksAISZBwAAME5kASDMPAAAgHEiCwBh5gEAAIwTWQAIMw8AKPn8+XN3fX3dHwHMi8gCQJh5AEDJ/v5+d3p62h8BzIvIAkCYeQBAicgCzJnIAkCYeQBAicgCzJnIAkCYeQBAicgCzJnIAkCYeQBAicgCzJnIAkCYeQBAicgCzJnIAkCYeQBAicgCzNnbt2/7W2siCwBZ5gEAJSILMGfL5bK/tSayAJBlHgBQIrIADIksAGSZBwCUiCwAQyILAFnmAQAlIgvAkMgCQJZ5AECJyAIwJLIAkGUeAFAisgAMiSwAZJkHAJSILABDIgsAWeYBACUiC8CQyAJAlnkAQMmnT5+6y8vL/ghgXj5+/NjfWhNZAMgyDwAAYNxi8SSpiCwA5JkHAAAwTmQBIMw8AACAcSILAGHmAQAAjBNZAAgzDwAAYJzIAkCYeQAAAONEFgDCzAMAABgnsgAQZh4AULJcLrvr6+v+CGBeRBYAwswDAEo+fPjQnZ6e9kcA8yKyABBmHgBQsr+/L7IAsyWyABBmHgBQIrIAcyayABBmHgBQIrIAcyayABBmHgBQIrIAcyayABBmHgBQIrIAcyayABBmHgBQIrIAc/b27dv+1prIAkCWeQBAicgCzNlyuexvrYksAGSZBwCUiCwAQyILAFnmAQAlIgvAkMgCQJZ5AECJyAIwJLIAkGUeAFAisgAMiSwAZJkHAJSILABDIgsAWeYBACUiC8CQyAJAlnkAQInIAjAksgCQZR4AUPLp06fu8vKyPwKYl48fP/a31kQWALLMAwAAGLdYPEkqIgsAeeYBAACME1kACDMPAABgnMgCQJh5AAAA40QWAMLMAwAAGCeyABBmHgAAwDiRBYAw8wCAiOVy2Z2fn/+rdXFx0Z9l3Gs+/99//92fZdz19XX2uZHl/M+vlz5/WhG550VXRO550RWRe150ReSeF10RuedFV/r6KElfZ7nnpiWyABBmHgAQ8fvvv3c7Ozv/eqXI8ZzXfv7Ly8v+THl//vln9nnR5fzPr5c+f/qH9HPS/bnnRZfzP79e+vzp6+M56esr97y7tbe31z9yTWQBIMs8AACAaUQWALLMAwAAmEZkASDLPAAAgGlEFgCyzAMAAJhGZAEgyzwAAIBpRBYAsswDAACYRmQBIMs8AACAaUQWALLMAwAAmEZkASDLPAAAgGlEFgCyzAMAAJhGZAEgyzwAAIBpRBYAsswDAACYRmQBIMs8AACAaUQWALLMAwAAmEZkASDLPAAAgGlEFgCyzAMAAJhGZAEgyzwAAIBpRBYAsswDAACYRmQBIMs8AACAaUQWALLMAwAAmEZkASDLPAAAgGlEFgCyzAMAAJhGZAEgyzwAAIBpRBYAsswDAACY5klkeffuXffDDz90Ozs7lmVZ1ozXmzdvus+fP/fTAQAAKHkSWdIF9fn5uWVZljXzdXFx0U8GAACgrOv+DysEQmMsv9ZhAAAAAElFTkSuQmCC" width="1113" height="294" class="img_ev3q"></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">double</span><span class="token plain"> image_h_w_rate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">double</span><span class="token plain"> widget_h_w_rate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QSizeF source_size</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image_h_w_rate </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> widget_h_w_rate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QSizeF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> widget_h_w_rate</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QSizeF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> widget_h_w_rate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QRectF source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QRectF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">QPointF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">source_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">painter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">drawImage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>此时，影像可以正确的比例显示在widget中，但显示区域是以左上角为起点，并不居中。</p>
<p>如果想要居中显示，需要建立影像<code>image</code>和窗口<code>widget</code>之间的关联，需要引入参数影像窗口比，即影像尺寸与窗口尺寸之间的比例关系，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mfrac><mrow><mi>i</mi><mi>m</mi><mi>g</mi></mrow><mrow><mi>w</mi><mi>g</mi><mi>t</mi></mrow></mfrac></msub><mo>=</mo><mi>i</mi><mi>m</mi><mi>a</mi><mi>g</mi><mi>e</mi><mi mathvariant="normal">.</mi><mi>s</mi><mi>i</mi><mi>z</mi><mi>e</mi><mi mathvariant="normal">/</mi><mi>w</mi><mi>i</mi><mi>d</mi><mi>g</mi><mi>e</mi><mi>t</mi><mi mathvariant="normal">.</mi><mi>s</mi><mi>i</mi><mi>z</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">r_{\frac{img}{wgt}} = image.size / widget.size</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0772em;vertical-align:-0.6466em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em"><span style="top:-2.6914em;margin-left:-0.0278em;margin-right:0.05em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9335em"><span style="top:-2.656em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02691em">w</span><span class="mord mathnormal mtight" style="margin-right:0.03588em">g</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.2255em"><span class="pstrut" style="height:3em"></span><span class="frac-line mtight" style="border-bottom-width:0.049em"></span></span><span style="top:-3.4624em"><span class="pstrut" style="height:3em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">im</span><span class="mord mathnormal mtight" style="margin-right:0.03588em">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4829em"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.6466em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathnormal">ima</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mord">.</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ze</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.02691em">w</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord">.</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ze</span></span></span></span></p>
<p>此处使用的image.size是经过上一步改变比例后的image，比例与widget相同。</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">QSizeF source_size</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">double</span><span class="token plain"> rate_image_divide_widget</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image_h_w_rate </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> widget_h_w_rate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QSizeF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> widget_h_w_rate</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rate_image_divide_widget </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QSizeF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> widget_h_w_rate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rate_image_divide_widget </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>确定影像与窗口的比例关系后，影像需要移动的长度为：</p>
<p>如果影像高宽比大于窗口高宽比，需要将影像显示范围向左移动：窗口宽度换算 为影像尺寸的宽度后，与影像宽度相减除以2的距离，即为将影像在中心显示时，影像显示区域起点的坐标。</p>
<p>同理，如果影像高宽比小于窗口高宽比，需要将影像显示范围向上移动：窗口高度换算为影像尺寸的高度后，与影像高度相减除以2的距离，即为将影像在中心显示时，影像显示区域起点的坐标。代码如下：</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image_h_w_rate </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> widget_h_w_rate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QRectF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">QPointF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_image_divide_widget </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">source_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QRectF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">QPointF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_image_divide_widget </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">source_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>综上，影像以正常比例，居中显示在窗口的代码为：</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">QPainter painter</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QImage image </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QImage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QRectF target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QRectF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QRectF source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QRectF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">image_h_w_rate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">widget_h_w_rate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image_h_w_rate </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> widget_h_w_rate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QSizeF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> widget_h_w_rate </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rate_image_divide_widget_new </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QSizeF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> widget_h_w_rate </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rate_image_divide_widget_new </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image_h_w_rate </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> widget_h_w_rate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QRectF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">QPointF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_image_divide_widget_new </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">source_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QRectF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">QPointF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_image_divide_widget_new </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">source_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">painter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">drawImage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2影像的缩放">2.影像的缩放<a href="#2影像的缩放" class="hash-link" aria-label="Direct link to 2.影像的缩放" title="Direct link to 2.影像的缩放">​</a></h3>
<p>缩放问题需要分解为两部分：</p>
<ol>
<li>设置一个缩放系数<code>rate_wheel</code>，根据缩放系数修改影像显示区域<code>source</code>，重新绘制影像；</li>
<li>确定缩放点，缩放时需要以鼠标为中心对影像进行缩放处理。</li>
</ol>
<p>缩放系数的确定相对比较容易，以鼠标为中心点缩放的思路为：</p>
<ol>
<li>获取鼠标在窗口的坐标（等价于鼠标到窗口(0,0)点的坐标）</li>
<li>使用缩放前的缩放系数和影像窗口比换算成鼠标在影像中的坐标；</li>
<li>缩放系数改变后，鼠标在窗口和影像中的坐标不应该发生变化；</li>
<li>缩放系数改变后，需要修改影像显示区域的起点坐标；</li>
<li>已知缩放前鼠标在影像中的坐标，又可以通过缩放后鼠标距离窗口起始点的坐标换算得到鼠标距离影像起始点的距离，从而计算得到所房后的影像起始点坐标。</li>
</ol>
<p>代码如下：</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">QPointF cursor_widget </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">mapFromGlobal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">cursor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">pos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QPointF cursor_image  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">topLeft</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> cursor_widget </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_image_divide_widget</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">QPointF source_topLeft_new </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cursor_image </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> cursor_widget </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_image_divide_widget_new</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QRectF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">source_topLeft_new</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">source_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rate_image_divide_widget </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> rate_image_divide_widget_new</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当缩放系数改变时，同样需要修改影像的显示尺寸<code>source_size</code></p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image_h_w_rate </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> widget_h_w_rate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QSizeF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> widget_h_w_rate </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rate_image_divide_widget_new </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QSizeF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> widget_h_w_rate </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rate_image_divide_widget_new </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>综上，支持影像正常成像和缩放的代码如下所示：</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">QPainter </span><span class="token function" style="color:#d73a49">painter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image_h_w_rate </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> widget_h_w_rate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QSizeF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> widget_h_w_rate </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rate_image_divide_widget_new </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QSizeF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> widget_h_w_rate </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rate_image_divide_widget_new </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_wheel </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rate_wheel </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 居中显示</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image_h_w_rate </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> widget_h_w_rate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QRectF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">QPointF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_image_divide_widget_new </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">width</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">source_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QRectF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">QPointF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_image_divide_widget_new </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">height</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">/</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">source_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rate_image_divide_widget </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> rate_image_divide_widget_new</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/// equal to get_cursor_in_image()</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    QPointF cursor_widget </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">mapFromGlobal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">cursor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">pos</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    QPointF cursor_image  </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">topLeft</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> cursor_widget </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_image_divide_widget</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    QPointF source_topLeft_new </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cursor_image </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> cursor_widget </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> rate_image_divide_widget_new</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">QRectF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">source_topLeft_new</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">source_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rate_image_divide_widget </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> rate_image_divide_widget_new</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">painter</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">drawImage</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="todo影像拖拽移动">todo：影像拖拽移动<a href="#todo影像拖拽移动" class="hash-link" aria-label="Direct link to todo：影像拖拽移动" title="Direct link to todo：影像拖拽移动">​</a></h3>
<p>有时间再继续补充</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/code/cpp_qt/qtwidgets_tablewidget"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">TableWidget</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/cmake"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">CMake</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#paintevent绘图事件" class="table-of-contents__link toc-highlight">paintEvent绘图事件</a></li><li><a href="#dragenterevent-dropevent-拖拽事件" class="table-of-contents__link toc-highlight">dragEnterEvent dropEvent 拖拽事件</a></li><li><a href="#paintevent_version2" class="table-of-contents__link toc-highlight">paintEvent_version2</a><ul><li><a href="#1影像的初始化显示" class="table-of-contents__link toc-highlight">1.影像的初始化显示</a></li><li><a href="#2影像的缩放" class="table-of-contents__link toc-highlight">2.影像的缩放</a></li><li><a href="#todo影像拖拽移动" class="table-of-contents__link toc-highlight">todo：影像拖拽移动</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a class="footer__link-item" href="/">Home</a><span class="footer__link-separator">·</span><a class="footer__link-item" href="/docs/intro">Document</a><span class="footer__link-separator">·</span><a class="footer__link-item" href="/docs/code/intro">Code</a><span class="footer__link-separator">·</span><a class="footer__link-item" href="/blog">Blog</a><span class="footer__link-separator">·</span><a href="https://github.com/li-tann/li-tann.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 li-tann's notebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>