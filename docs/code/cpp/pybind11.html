<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-code/cpp/pybind11" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">pybind11 | li-tann</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://li-tann.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://li-tann.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://li-tann.github.io/docs/code/cpp/pybind11"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="pybind11 | li-tann"><meta data-rh="true" name="description" content="pybind11logo"><meta data-rh="true" property="og:description" content="pybind11logo"><link data-rh="true" rel="icon" href="/img/SAR-LOGO2.png"><link data-rh="true" rel="canonical" href="https://li-tann.github.io/docs/code/cpp/pybind11"><link data-rh="true" rel="alternate" href="https://li-tann.github.io/docs/code/cpp/pybind11" hreflang="en"><link data-rh="true" rel="alternate" href="https://li-tann.github.io/docs/code/cpp/pybind11" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="li-tann RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="li-tann Atom Feed">




<link rel="stylesheet" href="/katex/katex.min.css"><link rel="stylesheet" href="/assets/css/styles.b9be658d.css">
<script src="/assets/js/runtime~main.b29fa3a2.js" defer="defer"></script>
<script src="/assets/js/main.e503b1ba.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/SAR-LOGO2.png" alt="Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/SAR-LOGO2.png" alt="Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">li-tann&#x27;s Notebook</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro">💬Document</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/code/intro">🧙Code</a><a class="navbar__item navbar__link" href="/blog">🏷️Blog</a><a href="https://github.com/li-tann/li-tann.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">🚀GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/SAR-LOGO2.png" alt="Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/SAR-LOGO2.png" alt="Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"><b>li-tann&#x27;s Notebook</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/code/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/cpp">Cpp</a><button aria-label="Collapse sidebar category &#x27;Cpp&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp/std_based_funs">Std based Funs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp/std">Std</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp/eigen">Eigen</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp/fmt">fmt</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp/gdal">GDAL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp/matlab">matlab</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp/nlohmann_json">nlohmann::json</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/code/cpp/pybind11">pybind11</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp/spdlog">spdlog</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp/sqlite3">sqlite3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp/std_regex">Regex</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/code/cpp/tinyxml">TinyXML</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/cpp-qt">Cpp Qt</a><button aria-label="Expand sidebar category &#x27;Cpp Qt&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/cmake">CMake</a><button aria-label="Expand sidebar category &#x27;CMake&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/python">Python</a><button aria-label="Expand sidebar category &#x27;Python&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/cuda">CUDA</a><button aria-label="Expand sidebar category &#x27;CUDA&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/shell">Shell</a><button aria-label="Expand sidebar category &#x27;Shell&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/cpp"><span itemprop="name">Cpp</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">pybind11</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>pybind11</h1></header>
<p><img decoding="async" loading="lazy" alt="pybind11_logo" src="/assets/images/pybind11_logo-8d803c9312cd96da2e5a20a8bf9e90fe.png" width="1131" height="336" class="img_ev3q"></p>
<p>使用CMake + Pybind11, 将C++写的算法/类，导出到Python中，类似于一个Python库/包</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="导入pybind11">导入pybind11<a href="#导入pybind11" class="hash-link" aria-label="Direct link to 导入pybind11" title="Direct link to 导入pybind11">​</a></h2>
<ol>
<li>vcpkg</li>
</ol>
<p>cd到vcpkg根 目录下, 下载pybind11库</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vcpkg install pybind11:x64-windows --clean-after-build</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在CMakeLists.txt内添加如下字段</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">find_package(Python COMPONENTS Interpreter Development)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(pybind11 CONFIG)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>sub_directory</li>
</ol>
<p>pybind11是一个header-only库, 所以直接把它当做子项目加载到当前项目中也非常方便</p>
<p>从github下载<a href="https://github.com/pybind/pybind11" target="_blank" rel="noopener noreferrer">pybind11</a>到指定路径。</p>
<p>项目结构，如下所示</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">projects/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pybind11/   &lt;-- 从github上下载的pybind11项目</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        docs/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        include/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tools/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        setup.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mylib.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CMakeLists.txt  &lt;-- 项目根目录的CMakeLists.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在外侧CMakeLists.txt中添加如下字段</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">add_subdirectory(pybind11)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建模板库">创建模板库<a href="#创建模板库" class="hash-link" aria-label="Direct link to 创建模板库" title="Direct link to 创建模板库">​</a></h2>
<p>不同于C++中常见的可执行文件&#x27;executable&#x27;, 动态库&#x27;shared library&#x27;, 又或是静态库&#x27;static library&#x27;, pybind11的目标在VSCode被标记为模板库&#x27;module library&#x27;。</p>
<p>在创建模板库时也不应该使用C++中常用的<code>add_library</code>, <code>add_executable</code>, 而是<code>pybind11_add_module</code>.</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pybind11_add_module(py_ltie</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        your_libs.cpp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target_link_libraries(py_ltie PUBLIC my_utils)  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target_link_libraries(py_ltie PUBLIC my_algo)   # my_utils, my_algo 都是依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">target_link_libraries(py_ltie PRIVATE pybind11::lto pybind11::embed pybind11::module pybind11::headers)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>执行一次CMake后, 该目标会显示在IDE(VSCode)中,</p>
<p><img decoding="async" loading="lazy" alt="alt text" src="/assets/images/py_ltie_target-6bd42d3d1ce24693d016b383d8c33524.png" width="695" height="202" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="pybind语法">pybind&quot;语法&quot;<a href="#pybind语法" class="hash-link" aria-label="Direct link to pybind&quot;语法&quot;" title="Direct link to pybind&quot;语法&quot;">​</a></h2>
<p>几乎所有语法都是写在<code>PYBIND11_MODULE(name, varible)</code>宏内。其中<code>name</code>名字应该与<code>pybind11_add_module</code>的第一个参数相同，<code>varible</code>则随意设置一个变量即可。</p>
<p>与上面CMake代码相对应的，</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// your_libs.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;pybind11/pybind11.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace py = pybind11;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PYBIND11_MODULE(py_ltie, m) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* 更多内容... */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>your_libs.cpp</code> 建议是一个独立的cpp文件, 它可以通过<code>#include &lt;...&gt;</code> 加载其他库里的类和函数, 而不需要在该文件中重新定义。</p>
<p><del>下面提到<code>PYBIND11_MODULE</code>的代码块, 都默认使用了<code>#include &lt;pybind11/pybind11.h&gt;</code>和<code>namespace py = pybind11;</code>, 也就不再赘述了</del></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="函数">函数<a href="#函数" class="hash-link" aria-label="Direct link to 函数" title="Direct link to 函数">​</a></h3>
<p>大部分“蜻蜓点水”式介绍pybind11的文章/视频，都会提到。</p>
<p>实际上就是用了pybind官方文档的<a href="https://pybind11.readthedocs.io/en/stable/basics.html#creating-bindings-for-a-simple-function" target="_blank" rel="noopener noreferrer">First steps #Creating bindings for a simple function</a>的内容...</p>
<p>写一个函数, 就完事了。完整的代码示例如下：</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// your_libs.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;pybind11/pybind11.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int add(int i, int j) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return i + j;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PYBIND11_MODULE(py_ltie, m) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    m.doc() = &quot;pybind11 example plugin&quot;; // optional module docstring</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    m.def(&quot;add&quot;, &amp;add, &quot;A function that adds two numbers&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在我还不太理解pybind11工作原理的时候，这么点示例完全不够我去举一反三的。我甚至一度以为要在自己的每个cpp下面都  加一个<code>PYBIND11_MODULE</code>...</p>
<p>有一点需要注意：</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">      这里的py_lite ↓  应该与cmakelist.txt里的&#x27;py_lite&#x27;保持一致(否则会在import py_lite时提示动态模板没有初始化)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PYBIND11_MODULE(py_ltie, m) {    &lt;-- 这里的m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  和这个m需要保持一致 --&gt; m.def(&quot;add&quot;, &amp;add, &quot;A func...&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>言归正传，普通函数的转换语法为：</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PYBIND11_MODULE(py_ltie, m) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    m.def(&quot;add&quot;, &amp;add, &quot;A function that adds two numbers&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>第一个参数, <code>&quot;add&quot;</code>是在该函数在python中的名称；</p>
<p>第二个参数，<code>&amp;add</code>是输入了该函数的地址</p>
<p>第三个参数，<code>&quot;A func...&quot;</code>是对该函数的解释说明（在<a href="#pybind11-stubgen">pybind11-stubgen</a>章节生成pyi文件后, IDE中就会显示该函数的解释说明）</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="类">类<a href="#类" class="hash-link" aria-label="Direct link to 类" title="Direct link to 类">​</a></h3>
<p>面向对象是C++内常见的编程思路，所以自定义的类才是最需要提供python接口的... 但网上愿意翻译一下官方文档讲一下它的人愣是没几个...</p>
<p>前提：</p>
<p>我之前写了一个小工具动态库<code>my_utils.dll</code>，并且该库已经通过<code>target_link_libraries</code>加载到<code>py_lite</code>模板库中。</p>
<p>其中在utils/datatype.h中我定义了一个结构体<code>xyz</code>用于存放空间直角坐标系数据, 形如</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// include/utils/datatype.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class llh; /// longitude, latitude, height</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class xyz </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xyz();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ~xyz();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xyz(double X, double Y, double Z);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    double norm();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xyz abs();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xyz unit();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xyz cross(xyz sec);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xyz operator-(xyz sec);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xyz operator+(xyz sec);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    double operator*(xyz sec);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xyz operator*(double m);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    llh to_llh();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    llh to_llh(double major, double minor);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void from_llh(llh lonlathei, double major, double minor);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    double x, y, z;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// src/utils/datatype.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* 存放相应的函数实现代码 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>转换语法</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// your_libs.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;pybind11/pybind11.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace py = pybind11;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;utils/datatype.h&gt; /// 这是我自己写的动态库, 在CMakeLists中已经通过`target_link_libraries`链接了</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PYBIND11_MODULE(py_ltie, m) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    py::class_&lt;xyz&gt;(m, &quot;xyz&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(py::init&lt;&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(py::init&lt;double, double, double&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def_readwrite(&quot;x&quot;,&amp;xyz::x)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def_readwrite(&quot;y&quot;,&amp;xyz::y)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def_readwrite(&quot;z&quot;,&amp;xyz::z)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /*其他成员变量*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;norm&quot;,&amp;xyz::norm)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;abs&quot;,&amp;xyz::abs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;unit&quot;,&amp;xyz::unit)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;cross&quot;,&amp;xyz::cross);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>1 <code>py::class_&lt;&gt;()</code></p>
<p><code>py::class_&lt;llh&gt;(m, &quot;xyz&quot;)</code>是在python中创建一个llh类，其中第一个<code>&lt;xyz&gt;</code>是C++中的类，第二个<code>&quot;xyz&quot;</code>是该类在python中的名称，即调用方法。在后面加<code>.def</code>, <code>.def_readonly</code>, <code>.def_readwrite</code>的行为，就是在python中为该类夹可以调用的成员函数、成员变量等内容...</p>
<p>2 构造函数</p>
<p>首先，构造函数是必须存在的。因为我在llh类中设置了两种构造函数，一种是不需要入参的<code>xyz()</code>，另一种是有三个入参的<code>xyz(double, double, double)</code>，所以我需要写两个<code>py::init</code>（我也可以不写全，但没写的构造方法也就没办法在python中使用）。</p>
<p><code>.def(py::init&lt;&gt;())</code>对应<code>xyz()</code>, <code>.def(py::init&lt;double, double, double&gt;())</code>对应<code>xyz(double, double, double)</code>。如果你的类里有其他的构造函数，依次类推...</p>
<p>3 共有成员变量</p>
<p><code>.def_readwrite(&quot;x&quot;,&amp;xyz::x)</code>可以为成员变量<code>x</code>提供有可读可写的接口。第一个<code>&quot;x&quot;</code>该成员函数在python中的名称，也是调用方法。第二个<code>&amp;xyz::x</code>是它的地址。如果我们想设置只读类型的接口，可以把<code>.def_readwrite(...)</code>替换为<code>.def_readonly(...)</code>。</p>
<p>4 私有成员变量</p>
<p>对于私有变量(<code>private:</code>), 可以使用<code>.def_property(&quot;name&quot;, &amp;class::get, &amp;class::set)</code>定义</p>
<p>TODO: 没写完, 以后用到了再补充</p>
<p>5 成员函数</p>
<p>方法与成员变量类似。</p>
<p>以<code>.def(&quot;norm&quot;,&amp;xyz::norm)</code>为例，该函数是计算坐标模长的函数。第一个<code>&quot;norm&quot;</code>是该成员变量在python中的名称，也是调用方法。第二个<code>&amp;xyz::norm</code>是它的函数地址。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="重载的成员函数">重载的成员函数<a href="#重载的成员函数" class="hash-link" aria-label="Direct link to 重载的成员函数" title="Direct link to 重载的成员函数">​</a></h3>
<p>由于python并不支持函数重载，所以对于C++类里重载的成员函数，pybind11提供的方法是：<code>py::overload_cast&lt;double&gt;(&amp;class::func)</code>, 将重载函数定义不同的调用方法。</p>
<p>仍以<a href="#%E7%B1%BB">类</a>中提到的<code>xyz</code>为例，成员函数<code>to_llh()</code>存在重载情况，实现方法为,</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// your_libs.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;pybind11/pybind11.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace py = pybind11;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;utils/datatype.h&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PYBIND11_MODULE(py_ltie, m) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    py::class_&lt;xyz&gt;(m, &quot;xyz&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(py::init&lt;&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(py::init&lt;double, double, double&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;to_llh_wgs84&quot;, py::overload_cast&lt;&gt;(&amp;xyz::to_llh))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;to_llh&quot;, py::overload_cast&lt;double, double&gt;(&amp;xyz::to_llh))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /*其他成员变量 或成员函数*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;cross&quot;,&amp;xyz::cross);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>通过<code>py::overload_cast&lt;..&gt;(..)</code>,</p>
<p>将不需要入参、默认使用WGS84椭球参数的函数<code>to_llh</code>在python的调用方法，修改为<code>&quot;to_llh_wgs84&quot;</code>,</p>
<p>将需要输入椭球长短半轴的函数<code>to_llh</code>在python中的调用方法，修改为<code>&quot;to_llh&quot;</code></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="operator">operator<a href="#operator" class="hash-link" aria-label="Direct link to operator" title="Direct link to operator">​</a></h3>
<p>1 加减乘除双目运算符</p>
<p>仍以<a href="#%E7%B1%BB">类</a>中提到的<code>xyz</code>为例，类里包含了加减乘除运算符，实现方法为,</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// your_libs.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;pybind11/pybind11.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace py = pybind11;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;utils/datatype.h&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PYBIND11_MODULE(py_ltie, m) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    py::class_&lt;xyz&gt;(m, &quot;xyz&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(py::init&lt;&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(py::init&lt;double, double, double&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;__add__&quot;, &amp;xyz::operator+)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;__sub__&quot;, &amp;xyz::operator-)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;__mul__&quot;, &amp;xyz::operator*)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;__truediv__&quot;, &amp;xyz::operator/)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /*其他成员变量 或成员函数*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;cross&quot;,&amp;xyz::cross);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>2 bool隐式转换</p>
<p>另一个类<code>funcrst</code>，是执行函数返回的信息，记可隐式转换为bool值, 直接使用if判断是否执行成功</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct funcrst{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    funcrst() { result = false; explain = &quot;&quot;; };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    funcrst(bool b, std::string s) { result = b; explain = s; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool result{ false };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::string explain{ &quot;&quot; };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    operator bool() { return result; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>语法为，</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// your_libs.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;pybind11/pybind11.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace py = pybind11;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;utils/datatype.h&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PYBIND11_MODULE(py_ltie, m) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    py::class_&lt;xyz&gt;(m, &quot;xyz&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /* ... */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(py::init&lt;&gt;());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    py::class_&lt;funcrst&gt;(m, &quot;funcrst&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(py::init&lt;&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(py::init&lt;bool, std::string&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def_readwrite(&quot;result&quot;,&amp;funcrst::result)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def_readwrite(&quot;explain&quot;,&amp;funcrst::explain)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;__bool__&quot;, &amp;funcrst::operator bool);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="枚举">枚举<a href="#枚举" class="hash-link" aria-label="Direct link to 枚举" title="Direct link to 枚举">​</a></h3>
<p>c++中的（强）枚举，</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">enum class Look_Diredction      { error, left, right }; </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>转到pybind11,</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// your_libs.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;pybind11/pybind11.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace py = pybind11;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;utils/datatype.h&gt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;algo/datatype.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PYBIND11_MODULE(py_ltie, m) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    py::class_&lt;xyz&gt;(m, &quot;xyz&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /* ... */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(py::init&lt;&gt;());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    py::class_&lt;funcrst&gt;(m, &quot;funcrst&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /* ... */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(py::init&lt;&gt;());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    py::enum_&lt;Look_Diredction&gt;(m, &quot;look_direction&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .value(&quot;error&quot;, Look_Diredction::error)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .value(&quot;left&quot;, Look_Diredction::left)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .value(&quot;right&quot;, Look_Diredction::right)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .export_values();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="模板类">模板类<a href="#模板类" class="hash-link" aria-label="Direct link to 模板类" title="Direct link to 模板类">​</a></h3>
<p>以<code>pt2&lt;&gt;</code>为例, 是一个存放和计算像平面坐标的模板类,</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/// include/utils/datatype.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">template&lt;typename type&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class pt2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static_assert(std::is_same&lt;type, int&gt;::value || std::is_same&lt;type, double&gt;::value </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  , &quot;Type must be short int, or double.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pt2() :c(0), r(0) {};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pt2(type row_, type col_) :c(col_), r(row_) {};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type norm() { ...};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pt2&lt;type&gt; abs_() { ... };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pt2&lt;type&gt; unit() { ...};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool operator !=(pt2&lt;type&gt; src) {return !operator==(src);};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool operator ==(const pt2&lt;type&gt; src) {...};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pt2&lt;type&gt; operator-(pt2&lt;type&gt; src) {...};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pt2&lt;type&gt; operator+(pt2&lt;type&gt; src) {...};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pt2&lt;type&gt; operator/(const type m) {...};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pt2&lt;type&gt; operator*(const type m) {...};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template&lt;typename _Ty2&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pt2&lt;_Ty2&gt; to() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return pt2&lt;_Ty2&gt;(this-&gt;r, this-&gt;c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type r; /// @brief equal with &#x27;y&#x27; &amp; &#x27;row&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    type c; /// @brief equal with &#x27;x&#x27; &amp; &#x27;col&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我们需要在python中提供<code>pt2&lt;int&gt;</code>和<code>p2&lt;double&gt;</code>的数据接口，那么需要在<code>your_libs.cpp</code>中定义一个模板函数&quot;特化&quot;的函数。</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">template &lt;typename T&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void template_pt2(py::module&amp; m, const std::string&amp; className) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    py::class_&lt;pt2&lt;T&gt;&gt;(m, className.c_str())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(py::init&lt;&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(py::init&lt;T, T&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;norm&quot;,&amp;pt2&lt;T&gt;::norm)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;abs&quot;,&amp;pt2&lt;T&gt;::abs_)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;unit&quot;,&amp;pt2&lt;T&gt;::unit)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;__add__&quot;, &amp;pt2&lt;T&gt;::operator+)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;__sub__&quot;, &amp;pt2&lt;T&gt;::operator-)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;__mul__&quot;, &amp;pt2&lt;T&gt;::operator*)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def(&quot;__truediv__&quot;, &amp;pt2&lt;T&gt;::operator/)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def_readwrite(&quot;r&quot;, &amp;pt2&lt;T&gt;::r)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .def_readwrite(&quot;c&quot;, &amp;pt2&lt;T&gt;::c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PYBIND11_MODULE(py_ltie, m) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* 其他定义 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template_pt2&lt;int&gt;(m, &quot;pt2i&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template_pt2&lt;double&gt;(m, &quot;pt2d&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="todo">TODO<a href="#todo" class="hash-link" aria-label="Direct link to TODO" title="Direct link to TODO">​</a></h3>
<p>派生类, 静态变量等... 以后有机会接触到了再完善相关内容</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="pyd使用">pyd使用<a href="#pyd使用" class="hash-link" aria-label="Direct link to pyd使用" title="Direct link to pyd使用">​</a></h2>
<p>完成上述内容后, 通过编译可以得到几个文件</p>
<ul>
<li>py_ltie.cp310-win_amd64.pyd</li>
<li>py_ltie.exp</li>
<li>py_ltie.lib</li>
<li>python310.dll</li>
</ul>
<p>(因为我链接的python版本是310, C++编译器是amd64版, 所以得到的pyd文件的后缀是“cp310-win_amd64.pyd”)</p>
<p>将这些文件与<code>my_utils.dll</code>, <code>my_algo.dll</code>依赖的三方动  态库，放到同一目录下（最好可以被python检索到）</p>
<p>比如，这py_ltie依赖<code>my_utils.dll</code>, <code>my_algo.dll</code>，而俩动态库又依赖gdal, fmt, tinyxml2, nlohoman_json, fftw等动态库。但通常在编译<code>my_utils.dll</code>和 <code>my_algo.dll</code>时，系统就已经配好环境了。</p>
<p>我将它们（pyd, mu_utils.dll, my_algo.dll, gdal.dll, libtiff.dll, ...）打包放到<code>d:/python310/Lib/site-packages/ltie/</code>地址内。（ltie是该工程的命名缩写）</p>
<p>任意位置创建一个.py文件, 写入</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> ltie</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">py_ltie </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pt2d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pt2d</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">23.12</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9.42</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p2 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pt2i</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">9.2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p3 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p1 </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> p2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;p1 :&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> p1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> p1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;p2 :&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> p2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> p2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;p3 :&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> p3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> p3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;p3.norm :&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> p3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">norm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>from ltie.py_ltie import pt2i</code>中,</p>
<ul>
<li><code>ltie</code>是site-packages下的文件夹&quot;ltie&quot;</li>
<li><code>py_ltie</code>是我们生成的pyd文件,</li>
<li><code>pt2i</code>是py_ltie中的一个特化模板类</li>
</ul>
<p>执行python脚本, 得到结果如下所示</p>
<p><img decoding="async" loading="lazy" alt="py_ltie_running_result" src="/assets/images/py_ltie_running_result-5099492bf35a63c61874c2e994f094a5.png" width="796" height="304" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="pybind11-stubgen">pybind11-stubgen<a href="#pybind11-stubgen" class="hash-link" aria-label="Direct link to pybind11-stubgen" title="Direct link to pybind11-stubgen">​</a></h2>
<p>生成pyd文件后, 我们已经可以基于它编写python脚本, 但没有智能提示会导致非常容易写错代码, 所以我们需要借助<code>pybind11-stubgen</code>工具来制作与pyd文件相对应的pyi文件，使IDE的智能提示功能正常工作。</p>
<p>安装</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip install pybind11-stubgen</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>输入<code>pybind11-stubgen -v</code>可以查看是否安装成功。</p>
<p>在保证pyd文件可以被python工具检索到后, 输入<code>pybind11-stubgen.exe py_ltie</code>, 如果没有快速报错, 一般就是输出成功了</p>
<p>结束后会在当前地址(比如我所使用设备的powershell的默认地址是c:/user/lenovo)创建一个stubs文件夹, 里面有一个ltie文件夹, 里面存放这一个py_ltie.pyi</p>
<p>将pyi文件拷贝至site-packages/ltie/后, 再次使用VSCode写代码时, 就出现了智能提示。</p>
<p><img decoding="async" loading="lazy" alt="pyi" src="/assets/images/pybind11_pyi-6307da1fa23657a3e14d813a5f419749.png" width="940" height="399" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/cpp">Cpp</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/pybind-11">Pybind11</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-01-02T01:16:54.000Z" itemprop="dateModified">Jan 2, 2025</time></b> by <b>li-tann</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/code/cpp/nlohmann_json"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">nlohmann::json</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/code/cpp/spdlog"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">spdlog</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#导入pybind11" class="table-of-contents__link toc-highlight">导入pybind11</a></li><li><a href="#创建模板库" class="table-of-contents__link toc-highlight">创建模板库</a></li><li><a href="#pybind语法" class="table-of-contents__link toc-highlight">pybind&quot;语法&quot;</a><ul><li><a href="#函数" class="table-of-contents__link toc-highlight">函数</a></li><li><a href="#类" class="table-of-contents__link toc-highlight">类</a></li><li><a href="#重载的成员函数" class="table-of-contents__link toc-highlight">重载的成员函数</a></li><li><a href="#operator" class="table-of-contents__link toc-highlight">operator</a></li><li><a href="#枚举" class="table-of-contents__link toc-highlight">枚举</a></li><li><a href="#模板类" class="table-of-contents__link toc-highlight">模板类</a></li><li><a href="#todo" class="table-of-contents__link toc-highlight">TODO</a></li></ul></li><li><a href="#pyd使用" class="table-of-contents__link toc-highlight">pyd使用</a></li><li><a href="#pybind11-stubgen" class="table-of-contents__link toc-highlight">pybind11-stubgen</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a class="footer__link-item" href="/">Home</a><span class="footer__link-separator">·</span><a class="footer__link-item" href="/docs/intro">Document</a><span class="footer__link-separator">·</span><a class="footer__link-item" href="/docs/code/intro">Code</a><span class="footer__link-separator">·</span><a class="footer__link-item" href="/blog">Blog</a><span class="footer__link-separator">·</span><a href="https://github.com/li-tann/li-tann.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 li-tann's notebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>